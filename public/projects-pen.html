<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Projects — antn.studio</title>

  <!-- Fonts -->
  <link href="https://fonts.cdnfonts.com/css/thegoodmonolith" rel="stylesheet" />
  <link href="https://fonts.cdnfonts.com/css/pp-neue-montreal" rel="stylesheet" />

  <style>
    /* ============ Base ============ */
    :root {
      --spacing-base: 1rem;
      --color-text: #fff;
      --font-size-base: 14px;
      --transition-medium: .3s ease;
      --border-radius: 0px;
      --vignette-size: 0px;
      --hover-scale: 1.05;
      /* Page vignette */
      --page-vignette-size: 180px;
      --page-vignette-color: rgba(0,0,0,.85);
      --page-vignette-strong-size: 90px;
      --page-vignette-strong-color: rgba(0,0,0,.92);
      --page-vignette-extreme-size: 36px;
      --page-vignette-extreme-color: rgba(0,0,0,1);
    }
    *{margin:0;padding:0;box-sizing:border-box;user-select:none}
    body{
      font-family:"PP Neue Montreal",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      background: transparent;                /* ← fond transparent pour voir la matrice */
      color:#fff;
      overflow:hidden;
      position:relative;
    }

    /* Grain (adouci) */
    body::before{
      content:"";position:fixed;inset:-50%;
      background:url("https://assets.iceable.com/img/noise-transparent.png") repeat 0 0/300px 300px;
      animation:noise .3s steps(5) infinite;
      opacity:.35;                             /* ← moins présent pour laisser respirer */
      pointer-events:none;
      z-index:100;
    }
    @keyframes noise{
      0%{transform:translate(0,0)}10%{transform:translate(-2%,-3%)}
      20%{transform:translate(-4%,2%)}30%{transform:translate(2%,-4%)}
      40%{transform:translate(-2%,5%)}50%{transform:translate(-4%,2%)}
      60%{transform:translate(3%,0)}70%{transform:translate(0,3%)}
      80%{transform:translate(-3%,0)}90%{transform:translate(2%,2%)}
      100%{transform:translate(1%,0)}
    }

    /* Voile flou au-dessus de la matrice, sous le contenu */
    .matrix-softener{
      position:fixed;
      inset:0;
      z-index:0;                               /* ← en dessous du contenu */
      pointer-events:none;                      /* ← ne bloque rien */
      backdrop-filter: blur(1.4px);
      -webkit-backdrop-filter: blur(1.4px);
      background: rgba(0,0,0,.18);             /* léger assombrissement */
    }

    a{position:relative;color:var(--color-text);text-decoration:none;font-weight:700;font-size:var(--font-size-base)}
    a::after{content:"";position:absolute;inset:0 0 0 auto;width:0;background:var(--color-text);z-index:-1;transition:width .3s cubic-bezier(.34,1.56,.64,1)}
    a:hover{color:#000;mix-blend-mode:difference}
    a:hover::after{width:100%}

    p{font-size:14px;font-weight:600;letter-spacing:-.01em}

    /* ============ Layout bars ============ */
    .header,.footer{
      position:absolute;left:0;width:100vw;padding:1.2rem;z-index:10000;
      display:grid;grid-template-columns:repeat(12,1fr);column-gap:var(--spacing-base)
    }
    .header{top:0}
    .footer{bottom:0}

    /* Masquer le menu années si contrôlé par le parent */
    html[data-year-controlled="true"] .legacy-year-menu { display: none !important; }

    /* Header: années à gauche */
    .years-section{grid-column:1 / span 4}
    .years{display:flex;flex-wrap:wrap;gap:.5rem 1rem}
    .year-btn{
      all:unset;cursor:pointer;color:#aaa;font-weight:700;letter-spacing:-.01em
    }
    .year-btn[aria-pressed="true"]{color:#fff}
    .year-btn:hover{color:#fff}

    /* Footer */
    .coordinates-section{grid-column:1 / span 4;font-family:"TheGoodMonolith",monospace}
    .links-section{grid-column:5 / span 4;display:flex;justify-content:center;gap:1rem}
    .info-section{grid-column:9 / span 4;text-align:right;font-family:"TheGoodMonolith",monospace}

    /* ============ Canvas/grid ============ */
    .container{position:relative;width:100vw;height:100vh;overflow:hidden;cursor:grab; z-index:1;} /* ← au-dessus du flou */
    .canvas{position:absolute;will-change:transform}

    .item{position:absolute;overflow:hidden;background:#000;cursor:pointer;border-radius:var(--border-radius)}
    .item-image-container{position:relative;width:100%;height:100%;overflow:hidden}
    .item-image-container::after{
      content:"";position:absolute;inset:0;pointer-events:none;box-shadow:inset 0 0 var(--vignette-size) rgba(0,0,0,.5);z-index:1
    }
    .item img{width:100%;height:100%;object-fit:cover;pointer-events:none;transition:transform .3s ease}
    .item:hover img{transform:scale(var(--hover-scale))}
    .item-caption{position:absolute;left:0;bottom:0;width:100%;padding:10px;z-index:2}
    .item-name{font-size:12px;text-transform:uppercase;letter-spacing:-.03em;margin-bottom:2px;overflow:hidden;height:16px}
    .item-number{font:400 10px/1 "TheGoodMonolith",monospace;color:#888;overflow:hidden;height:14px}

    /* Zoom */
    .expanded-item{position:fixed;z-index:10000;top:50%;left:50%;transform:translate(-50%,-50%);background:#000;overflow:hidden;cursor:pointer;border-radius:var(--border-radius)}
    .expanded-item img{width:100%;height:100%;object-fit:cover;pointer-events:none}

    /* Overlay + vignette page */
    .overlay{position:fixed;inset:0;background:#000;pointer-events:none;opacity:0;z-index:9999}
    .overlay.active{pointer-events:auto}
    .page-vignette-container{position:fixed;inset:0;pointer-events:none;z-index:9998}
    .page-vignette{position:absolute;inset:0;box-shadow:inset 0 0 var(--page-vignette-size) var(--page-vignette-color)}
    .page-vignette-strong{position:absolute;inset:0;box-shadow:inset 0 0 var(--page-vignette-strong-size) var(--page-vignette-strong-color)}
    .page-vignette-extreme{position:absolute;inset:0;box-shadow:inset 0 0 var(--page-vignette-extreme-size) var(--page-vignette-extreme-color)}

    /* Titre central */
    .project-title{position:absolute;inset:0;display:grid;place-items:center;pointer-events:none;z-index:10002}
    .project-title p{position:relative;height:42px}
    .project-title p .word{display:inline-block;font-size:36px;letter-spacing:-.03em;text-transform:uppercase}

    /* Social links style au footer */
    .links-section a{font-weight:700;font-size:13px}
  </style>
</head>
<body>
  <!-- Voile flou qui adoucit la matrice de points derrière -->
  <div class="matrix-softener" aria-hidden="true"></div>

  <!-- ===== HEADER ===== -->
  <div class="header">
    <div class="years-section legacy-year-menu">
      <h3 style="font-size:14px;margin-bottom:.6rem;font-weight:600">+Years</h3>
      <div class="years" id="years"></div>
    </div>
    <!-- (le reste du header vide) -->
  </div>

  <!-- ===== FOOTER ===== -->
  <div class="footer">
    <div class="coordinates-section"><p>48.7264° N, 2.2770° E</p></div>
    <div class="links-section" id="socials"></div>
    <div class="info-section"><p>Est. 2025 • antn.studio</p></div>
  </div>

  <!-- ===== GRID ===== -->
  <div class="container">
    <div class="canvas" id="canvas"></div>
    <div class="overlay" id="overlay"></div>
  </div>

  <!-- Titre projet au centre -->
  <div class="project-title"><p></p></div>

  <!-- Vignette page -->
  <div class="page-vignette-container">
    <div class="page-vignette"></div>
    <div class="page-vignette-strong"></div>
    <div class="page-vignette-extreme"></div>
  </div>

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/CustomEase.min.js"></script>
  <script src="https://unpkg.com/split-type"></script>

  <script>
  (function(){
    const { gsap, CustomEase, SplitType } = window;
    gsap.registerPlugin(CustomEase);
    CustomEase.create("hop","0.9,0,0.1,1");

    /* =========================
       1) CONTENU ÉDITABLE
    ========================= */
    const PROJECTS = [
      { title: "Echo Discs", year: 2025, image: "https://cdn.cosmos.so/7b5340f5-b4dc-4c08-8495-c507fa81480b?format=jpeg" },
      { title: "Neon Handscape", year: 2025, image: "https://cdn.cosmos.so/2f49a117-05e7-4ae9-9e95-b9917f970adb?format=jpeg" },
      { title: "Solar Bloom", year: 2025, image: "https://cdn.cosmos.so/47caf8a0-f456-41c5-98ea-6d0476315731?format=jpeg" },
      { title: "Chromatic Loopscape", year: 2024, image: "https://cdn.cosmos.so/0f164449-f65e-4584-9d62-a9b3e1f4a90a?format=jpeg" },
      { title: "Nova Pulse", year: 2024, image: "https://cdn.cosmos.so/f733585a-081e-48e7-a30e-e636446f2168?format=jpeg" },
      { title: "Sonic Horizon", year: 2023, image: "https://cdn.cosmos.so/f99f8445-6a19-4a9a-9de3-ac382acc1a3f?format=jpeg" },
    ];

    const SOCIALS = [
      { label: "Instagram", href: "https://www.instagram.com/antnstudio/" },
      { label: "X / Twitter", href: "https://x.com/antnstudio" },
      { label: "LinkedIn", href: "https://www.linkedin.com/in/antnstudio/" },
    ];

    /* =========================
       2) PARAMÈTRES
    ========================= */
    const settings = {
      baseWidth: 400,
      smallHeight: 330,
      largeHeight: 500,
      itemGap: 65,
      hoverScale: 1.05,
      expandedScale: 0.4,
      dragEase: 0.075,
      momentumFactor: 200,
      bufferZone: 3,
      zoomDuration: 0.6,
      overlayOpacity: 0.9,
      overlayEaseDuration: 0.8
    };

    /* =========================
       3) ÉTAT / DOM
    ========================= */
    const container = document.querySelector(".container");
    const canvas = document.getElementById("canvas");
    const overlay = document.getElementById("overlay");
    const projectTitleElement = document.querySelector(".project-title p");
    const yearsEl = document.getElementById("years");
    const socialsEl = document.getElementById("socials");

    // Rendu socials (centré en bas)
    SOCIALS.forEach(s => {
      const a = document.createElement("a");
      a.href = s.href; a.target = "_blank"; a.rel = "noreferrer";
      a.textContent = s.label;
      socialsEl.appendChild(a);
    });

    // Années disponibles (desc)
    const uniqueYears = Array.from(new Set(PROJECTS.map(p => p.year))).sort((a,b)=>b-a);

    // State année (support ?year=YYYY sinon "All")
    const qpYear = new URLSearchParams(location.search).get("year");
    let activeYear = qpYear ? (qpYear === "all" ? "All" : String(qpYear)) : "All";

    /* ===== Années (legacy UI — masqué si piloté par le parent) ===== */
    function renderYears(){
      yearsEl.innerHTML = "";
      const allBtn = makeYearBtn("All");
      yearsEl.appendChild(allBtn);
      uniqueYears.forEach(y => yearsEl.appendChild(makeYearBtn(String(y))));
      updateYearButtons();
    }
    function makeYearBtn(label){
      const b = document.createElement("button");
      b.className = "year-btn";
      b.textContent = label;
      b.addEventListener("click", ()=>{ setActiveYear(label); });
      return b;
    }
    function updateYearButtons(){
      yearsEl.querySelectorAll(".year-btn").forEach(btn=>{
        btn.setAttribute("aria-pressed", String(btn.textContent === String(activeYear)));
      });
    }
    function setActiveYear(label){
      activeYear = label;
      document.documentElement.setAttribute("data-year", String(label).toLowerCase());
      resetAndRebuild();
      updateYearButtons();
    }

    // Liste selon filtre
    function currentList(){
      if(activeYear==="All") return PROJECTS;
      const y = parseInt(activeYear,10);
      return PROJECTS.filter(p => p.year === y);
    }

    // Variables de grille
    const itemSizes = [
      { width: settings.baseWidth, height: settings.smallHeight },
      { width: settings.baseWidth, height: settings.largeHeight }
    ];
    let itemGap = settings.itemGap, columns = 4;
    const cellWidth = settings.baseWidth + settings.itemGap;
    const cellHeight = Math.max(settings.smallHeight, settings.largeHeight) + settings.itemGap;

    let isDragging=false,startX,startY,targetX=0,targetY=0,currentX=0,currentY=0,dragVX=0,dragVY=0,lastDrag=0;
    let mouseHasMoved=false,visibleItems=new Set(),lastUpdate=0,lastX=0,lastY=0;
    let isExpanded=false,activeItem=null,activeItemId=null,canDrag=true,expandedItem=null,overlayAnim=null,titleSplit=null;

    /* =========================
       4) UTILS UI
    ========================= */
    function setAndAnimateTitle(title){
      if(titleSplit) titleSplit.revert();
      projectTitleElement.textContent = title;
      titleSplit = new SplitType(projectTitleElement,{ types:"words" });
      gsap.set(titleSplit.words,{ y:"100%" });
    }
    function animateTitleIn(){ gsap.fromTo(titleSplit.words,{ y:"100%",opacity:0 },{ y:"0%",opacity:1,duration:1,stagger:.1,ease:"power3.out" }); }
    function animateTitleOut(){ gsap.to(titleSplit.words,{ y:"-100%",opacity:0,duration:1,stagger:.1,ease:"power3.out" }); }
    function overlayIn(){
      if(overlayAnim) overlayAnim.kill();
      overlayAnim = gsap.to(overlay,{ opacity:settings.overlayOpacity, duration:settings.overlayEaseDuration, ease:"power2.inOut", overwrite:true });
    }
    function overlayOut(){
      if(overlayAnim) overlayAnim.kill();
      overlayAnim = gsap.to(overlay,{ opacity:0, duration:settings.overlayEaseDuration, ease:"power2.inOut" });
    }

    function getItemSize(row,col){ const idx = Math.abs((row*columns+col)%itemSizes.length); return itemSizes[idx]; }
    function getItemId(col,row){ return `${col},${row}`; }
    function getItemPos(col,row){ return { x: col*cellWidth, y: row*cellHeight }; }

    /* =========================
       5) BUILD / UPDATE
    ========================= */
    function updateVisibleItems(){
      const list = currentList();
      const itemCount = list.length || 1;

      const buffer = settings.bufferZone;
      const vw = innerWidth*(1+buffer), vh = innerHeight*(1+buffer);
      const startCol = Math.floor((-currentX - vw/2)/cellWidth);
      const endCol   = Math.ceil((-currentX + vw*1.5)/cellWidth);
      const startRow = Math.floor((-currentY - vh/2)/cellHeight);
      const endRow   = Math.ceil((-currentY + vh*1.5)/cellHeight);

      const currentSet = new Set();

      for(let row=startRow; row<=endRow; row++){
        for(let col=startCol; col<=endCol; col++){
          const id = getItemId(col,row); currentSet.add(id);
          if(visibleItems.has(id)) continue;
          if(activeItemId===id && isExpanded) continue;

          const size = getItemSize(row,col);
          const pos = getItemPos(col,row);
          const idx = Math.abs((row*columns+col) % itemCount);
          const proj = list[idx];

          const item = document.createElement("div");
          item.className="item"; item.id=id;
          item.style.width = `${size.width}px`;
          item.style.height = `${size.height}px`;
          item.style.left = `${pos.x}px`;
          item.style.top  = `${pos.y}px`;
          item.dataset.width = size.width;
          item.dataset.height = size.height;
          item.dataset.year = String(proj.year); /* utile pour debug/sel */

          const imageContainer = document.createElement("div");
          imageContainer.className = "item-image-container";
          const img = document.createElement("img");
          img.src = proj.image; img.alt = proj.title;
          imageContainer.appendChild(img); item.appendChild(imageContainer);

          const caption = document.createElement("div");
          caption.className = "item-caption";
          const name = document.createElement("div"); name.className="item-name"; name.textContent = proj.title;
          const number = document.createElement("div"); number.className="item-number"; number.textContent = `#${String(idx+1).padStart(5,"0")}`;
          caption.appendChild(name); caption.appendChild(number); item.appendChild(caption);

          item.addEventListener("click", () => { if(mouseHasMoved||isDragging) return; expandItem(item, proj); });

          canvas.appendChild(item); visibleItems.add(id);
        }
      }

      // cleanup
      visibleItems.forEach((id)=>{
        if(!currentSet.has(id) || (activeItemId===id && isExpanded)){
          const el = document.getElementById(id);
          if(el && el.parentNode===canvas) canvas.removeChild(el);
          visibleItems.delete(id);
        }
      });
    }

    function expandItem(item, proj){
      isExpanded=true; activeItem=item; activeItemId=item.id; canDrag=false; container.style.cursor="auto";

      setAndAnimateTitle(proj.title);

      const rect = item.getBoundingClientRect();
      const w = parseInt(item.dataset.width,10);
      const h = parseInt(item.dataset.height,10);
      overlay.classList.add("active"); overlayIn();

      const expandedItem = document.createElement("div");
      expandedItem.className="expanded-item";
      expandedItem.style.width=`${w}px`; expandedItem.style.height=`${h}px`;
      expandedItem.style.borderRadius="var(--border-radius)";
      const img = document.createElement("img"); img.src = item.querySelector("img").src;
      expandedItem.appendChild(img);
      expandedItem.addEventListener("click", closeExpandedItem);
      document.body.appendChild(expandedItem);

      document.querySelectorAll(".item").forEach(el=>{ if(el!==activeItem) gsap.to(el,{opacity:0,duration:settings.overlayEaseDuration,ease:"power2.inOut"}); });

      const vw = innerWidth;
      const targetW = vw*settings.expandedScale;
      const aspect = h/w; const targetH = targetW*aspect;

      gsap.delayedCall(.5, animateTitleIn);
      gsap.fromTo(expandedItem,
        { width:w, height:h, x: rect.left+w/2 - innerWidth/2, y: rect.top+h/2 - innerHeight/2 },
        { width:targetW, height:targetH, x:0, y:0, duration:settings.zoomDuration, ease:"hop" }
      );

      // stocke pour fermeture
      window.__expandedItem = expandedItem;
    }

    function closeExpandedItem(){
      const expandedItem = window.__expandedItem;
      if(!expandedItem) return;
      animateTitleOut(); overlayOut();

      document.querySelectorAll(".item").forEach(el=>{ if(el.id!==activeItemId) gsap.to(el,{opacity:1,duration:settings.overlayEaseDuration,delay:.3,ease:"power2.inOut"}); });

      const rect = activeItem.getBoundingClientRect();
      const w = parseInt(activeItem.dataset.width,10);
      const h = parseInt(activeItem.dataset.height,10);

      gsap.to(expandedItem,{
        width:w, height:h,
        x: rect.left+w/2 - innerWidth/2,
        y: rect.top+h/2 - innerHeight/2,
        duration:settings.zoomDuration, ease:"hop",
        onComplete:()=>{
          expandedItem.remove();
          window.__expandedItem = null;
          isExpanded=false; activeItem=null; activeItemId=null; canDrag=true;
          container.style.cursor="grab"; overlay.classList.remove("active");
        }
      });
    }

    function animate(){
      if(canDrag){
        const e=settings.dragEase;
        currentX += (targetX-currentX)*e;
        currentY += (targetY-currentY)*e;
        canvas.style.transform = `translate(${currentX}px,${currentY}px)`;
        const now = Date.now(), dist = Math.hypot(currentX-lastX,currentY-lastY);
        if(dist>100 || now-lastUpdate>120){ updateVisibleItems(); lastX=currentX; lastY=currentY; lastUpdate=now; }
      }
      requestAnimationFrame(animate);
    }

    // drag / touch
    container.addEventListener("mousedown",(e)=>{ if(!canDrag) return; isDragging=true; mouseHasMoved=false; startX=e.clientX; startY=e.clientY; container.style.cursor="grabbing"; });
    addEventListener("mousemove",(e)=>{ if(!isDragging||!canDrag) return; const dx=e.clientX-startX, dy=e.clientY-startY; if(Math.abs(dx)>5||Math.abs(dy)>5) mouseHasMoved=true; const now=Date.now(), dt=Math.max(10, now-lastDrag); lastDrag=now; dragVX=dx/dt; dragVY=dy/dt; targetX+=dx; targetY+=dy; startX=e.clientX; startY=e.clientY; });
    addEventListener("mouseup",()=>{ if(!isDragging) return; isDragging=false; if(canDrag){ container.style.cursor="grab"; if(Math.abs(dragVX)>0.1||Math.abs(dragVY)>0.1){ targetX += dragVX*settings.momentumFactor; targetY += dragVY*settings.momentumFactor; } } });
    overlay.addEventListener("click",()=>{ if(isExpanded) closeExpandedItem(); });

    container.addEventListener("touchstart",(e)=>{ if(!canDrag) return; isDragging=true; mouseHasMoved=false; startX=e.touches[0].clientX; startY=e.touches[0].clientY; });
    addEventListener("touchmove",(e)=>{ if(!isDragging||!canDrag) return; const dx=e.touches[0].clientX-startX, dy=e.touches[0].clientY-startY; if(Math.abs(dx)>5||Math.abs(dy)>5) mouseHasMoved=true; targetX+=dx; targetY+=dy; startX=e.touches[0].clientX; startY=e.touches[0].clientY; });
    addEventListener("touchend",()=>{ isDragging=false; });

    addEventListener("resize",()=>{ if(isExpanded&&window.__expandedItem&&activeItem){ const w=parseInt(activeItem.dataset.width,10), h=parseInt(activeItem.dataset.height,10); const targetW=innerWidth*settings.expandedScale, targetH=targetW*(h/w); gsap.to(window.__expandedItem,{width:targetW,height:targetH,duration:.3,ease:"power2.out"}); } else { updateVisibleItems(); } });

    function resetAndRebuild(){
      // nettoie
      visibleItems.forEach(id=>{ const el=document.getElementById(id); if(el&&el.parentNode===canvas) canvas.removeChild(el); }); visibleItems.clear();
      currentX=currentY=targetX=targetY=lastX=lastY=0; canvas.style.transform="translate(0,0)";
      updateVisibleItems();
    }

    /* ===== Pilotage par le parent (Next) ===== */
    window.addEventListener("message", (evt) => {
      const data = evt && evt.data;
      if (!data || data.type !== "SET_YEAR") return;
      const value = data.value;
      document.documentElement.setAttribute("data-year-controlled", "true");
      setActiveYear(value === "all" ? "All" : String(value));
    });

    // init
    renderYears();
    setActiveYear(activeYear); // applique état initial (query param ou All)
    updateVisibleItems();
    animate();
  })();
  </script>
</body>
</html>
