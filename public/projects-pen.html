<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Projects — antn.studio</title>

  <link href="https://fonts.cdnfonts.com/css/thegoodmonolith" rel="stylesheet" />
  <link href="https://fonts.cdnfonts.com/css/pp-neue-montreal" rel="stylesheet" />

  <style>
    :root{
      --spacing-base: 1rem;
      --color-text: #fff;
      --font-size-base: 14px;
      --transition-medium: .3s ease;
      --border-radius: 0px;
      --vignette-size: 0px;
      --hover-scale: 1.05;

      /* Vignette page */
      --page-vignette-size: 180px;
      --page-vignette-color: rgba(0,0,0,.85);
      --page-vignette-strong-size: 90px;
      --page-vignette-strong-color: rgba(0,0,0,.92);
      --page-vignette-extreme-size: 36px;
      --page-vignette-extreme-color: rgba(0,0,0,1);

      /* Matrice fixe (fond) */
      --m-bg: #0b0b0b;
      --m-dot-color: rgba(255,255,255,.08);
      --m-dot-size: 1.1px;
      --m-dot-space: 22px;
    }

    *{margin:0;padding:0;box-sizing:border-box;user-select:none}

    /* ===== Fond : matrice de points FIXE ===== */
    body{
      font-family:"PP Neue Montreal",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      color:#fff; overflow:hidden; position:relative;
      background-color: var(--m-bg);
      background-image:
        radial-gradient(circle, var(--m-dot-color) var(--m-dot-size), transparent calc(var(--m-dot-size) + 0.01px));
      background-size: var(--m-dot-space) var(--m-dot-space);
      background-position: 0 0;
      background-attachment: fixed;
    }

    /* Grain léger */
    body::before{
      content:""; position:fixed; inset:-50%;
      background:url("https://assets.iceable.com/img/noise-transparent.png") repeat 0 0/300px 300px;
      animation:noise .3s steps(5) infinite; opacity:.22; pointer-events:none; z-index:100;
    }
    @keyframes noise{
      0%{transform:translate(0,0)}10%{transform:translate(-2%,-3%)}
      20%{transform:translate(-4%,2%)}30%{transform:translate(2%,-4%)}
      40%{transform:translate(-2%,5%)}50%{transform:translate(-4%,2%)}
      60%{transform:translate(3%,0)}70%{transform:translate(0,3%)}
      80%{transform:translate(-3%,0)}90%{transform:translate(2%,2%)}
      100%{transform:translate(1%,0)}
    }

    a{position:relative;color:var(--color-text);text-decoration:none;font-weight:700;font-size:var(--font-size-base)}
    a::after{content:"";position:absolute;inset:0 0 0 auto;width:0;background:var(--color-text);z-index:-1;transition:width .3s cubic-bezier(.34,1.56,.64,1)}
    a:hover{color:#000;mix-blend-mode:difference}
    a:hover::after{width:100%}
    p{font-size:14px;font-weight:600;letter-spacing:-.01em}

    /* ===== Header / Footer ===== */
    .header,.footer{
      position:absolute; left:0; width:100vw; padding:1.2rem; z-index:10000;
      display:grid; grid-template-columns:repeat(12,1fr); column-gap:var(--spacing-base)
    }
    .header{top:0}
    .footer{bottom:0}

    /* On neutralise les styles “bulle” de la nav globale côté header uniquement */
    .header, .header *{
      background: transparent;
      box-shadow: none;
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
      border: 0;
    }

    /* === YEARS (menu de base, stylé dropdown flouté) === */
    .legacy-year-menu{grid-column:1 / span 4; position:relative;}
    .legacy-years-toggle{
      display:inline-flex; align-items:center; gap:.55rem;
      font-weight:800; font-size:13px; letter-spacing:.06em; text-transform:uppercase;
      color:#e9e9e9; cursor:pointer; padding:.4rem .6rem .4rem .2rem;
      border-radius:999px; user-select:none; position:relative;
    }
    .legacy-years-toggle::before{
      content:""; width:6px; height:6px; border-radius:50%;
      background:#e9e9e9; opacity:.9; display:inline-block; animation: blink 2.4s ease-in-out infinite;
    }
    @keyframes blink{0%,90%,100%{opacity:.9}45%{opacity:.3}}
    .chev{width:8px;height:8px;border-right:2px solid #e9e9e9;border-bottom:2px solid #e9e9e9;transform:rotate(45deg); transition:transform .2s ease; margin-left:.2rem;}
    .legacy-year-menu.open .chev{ transform:rotate(-135deg); }

    /* Panneau années : fermé = aucune empreinte visuelle */
.legacy-years-panel{
  position:absolute; left:0; top:2.6rem; z-index:10001;
  display:flex; flex-direction:column; gap:.35rem;
  overflow:hidden;

  /* état fermé */
  max-height:0;
  padding:0;                 /* ← enlève le petit bout qui restait */
  opacity:0;
  transform:translateY(-4px);
  pointer-events:none;
  transition:
    max-height .35s ease,
    padding .2s ease,
    opacity .2s ease,
    transform .2s ease;
}

/* état ouvert */
.legacy-year-menu.open .legacy-years-panel{
  max-height:50vh;
  padding:.45rem .4rem .55rem .4rem;
  opacity:1;
  transform:none;
  pointer-events:auto;
}

/* flou uniquement quand ouvert */
.legacy-years-panel::before{
  content:""; position:absolute; inset:-.2rem -1rem -.6rem -1rem; border-radius:8px;
  backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
  background: rgba(0,0,0,.06); z-index:-1;
  opacity:0;                                 /* ← caché fermé */
  transition: opacity .2s ease;
}
.legacy-year-menu.open .legacy-years-panel::before{ opacity:1; }


    .years{ display:flex; flex-direction:column; gap:.35rem; }
    .year-btn{
      all:unset; cursor:pointer; color:#bcbcbc; font-weight:700; letter-spacing:-.01em;
      padding:.22rem .55rem; border-radius:6px; transition:color .2s ease, background .2s ease;
      display:block;
    }
    .year-btn:hover{ color:#fff; background:rgba(255,255,255,0.05);}
    .year-btn[aria-pressed="true"]{ color:#fff; background:rgba(255,255,255,0.08);}
    .years-close{
      all:unset; cursor:pointer; align-self:flex-start; margin-top:.25rem;
      color:#ddd; font-weight:800; font-size:10px; letter-spacing:.14em; text-transform:uppercase;
      opacity:.8; padding:.2rem .5rem;
    }
    .years-close:hover{ opacity:1; }

    /* Footer */
    .coordinates-section{grid-column:1 / span 4;font-family:"TheGoodMonolith",monospace}
    .links-section{grid-column:5 / span 4;display:flex;justify-content:center;gap:1rem}
    .info-section{grid-column:9 / span 4;text-align:right;font-family:"TheGoodMonolith",monospace}

    /* ===== Canvas / grid ===== */
    .container{position:relative;width:100vw;height:100vh;overflow:hidden;cursor:grab; z-index:1;}
    .canvas{position:absolute;will-change:transform}

    .item{position:absolute;overflow:hidden;background:#000;cursor:pointer;border-radius:var(--border-radius)}
    .item-image-container{position:relative;width:100%;height:100%;overflow:hidden}
    .item-image-container::after{content:"";position:absolute;inset:0;pointer-events:none;box-shadow:inset 0 0 var(--vignette-size) rgba(0,0,0,.5);z-index:1}
    .item img{width:100%;height:100%;object-fit:cover;pointer-events:none;transition:transform .3s ease}
    .item:hover img{transform:scale(var(--hover-scale))}
    .item-caption{position:absolute;left:0;bottom:0;width:100%;padding:10px;z-index:2}
    .item-name{font-size:12px;text-transform:uppercase;letter-spacing:-.03em;margin-bottom:2px;overflow:hidden;height:16px}
    .item-number{font:400 10px/1 "TheGoodMonolith",monospace;color:#888;overflow:hidden;height:14px}

    .expanded-item{position:fixed;z-index:10000;top:50%;left:50%;transform:translate(-50%,-50%);background:#000;overflow:hidden;cursor:pointer;border-radius:var(--border-radius)}
    .expanded-item img{width:100%;height:100%;object-fit:cover;pointer-events:none}

    .overlay{position:fixed;inset:0;background:#000;pointer-events:none;opacity:0;z-index:9999}
    .overlay.active{pointer-events:auto}
    .page-vignette-container{position:fixed;inset:0;pointer-events:none;z-index:9998}
    .page-vignette{position:absolute;inset:0;box-shadow:inset 0 0 var(--page-vignette-size) var(--page-vignette-color)}
    .page-vignette-strong{position:absolute;inset:0;box-shadow:inset 0 0 var(--page-vignette-strong-size) var(--page-vignette-strong-color)}
    .page-vignette-extreme{position:absolute;inset:0;box-shadow:inset 0 0 var(--page-vignette-extreme-size) var(--page-vignette-extreme-color)}

    .project-title{position:absolute;inset:0;display:grid;place-items:center;pointer-events:none;z-index:10002}
    .project-title p{position:relative;height:42px}
    .project-title p .word{display:inline-block;font-size:36px;letter-spacing:-.03em;text-transform:uppercase}

    .links-section a{font-weight:700;font-size:13px}
  </style>
</head>
<body>
  <!-- ===== HEADER ===== -->
  <div class="header">
    <!-- Menu de base uniquement -->
    <div class="legacy-year-menu" id="legacyYears">
      <div class="legacy-years-toggle" id="legacyYearsToggle" role="button" aria-expanded="false" aria-controls="legacyYearsPanel">
        <span>+ YEARS</span>
        <span class="chev" aria-hidden="true"></span>
      </div>
      <div class="legacy-years-panel" id="legacyYearsPanel">
        <div class="years" id="years"></div>
        <button class="years-close" id="legacyYearsClose">Close</button>
      </div>
    </div>
  </div>

  <!-- ===== FOOTER ===== -->
  <div class="footer">
    <div class="coordinates-section"><p>48.7264° N, 2.2770° E</p></div>
    <div class="links-section" id="socials"></div>
    <div class="info-section"><p>Est. 2025 • antn.studio</p></div>
  </div>

  <!-- ===== GRID ===== -->
  <div class="container">
    <div class="canvas" id="canvas"></div>
    <div class="overlay" id="overlay"></div>
  </div>

  <div class="project-title"><p></p></div>

  <div class="page-vignette-container">
    <div class="page-vignette"></div>
    <div class="page-vignette-strong"></div>
    <div class="page-vignette-extreme"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/CustomEase.min.js"></script>
  <script src="https://unpkg.com/split-type"></script>

  <script>
  (function(){
    const { gsap, CustomEase, SplitType } = window;
    gsap.registerPlugin(CustomEase);
    CustomEase.create("hop","0.9,0,0.1,1");

    /* ===== Contenu ===== */
    const PROJECTS = [
      { title: "Echo Discs", year: 2025, image: "https://cdn.cosmos.so/7b5340f5-b4dc-4c08-8495-c507fa81480b?format=jpeg" },
      { title: "Neon Handscape", year: 2025, image: "https://cdn.cosmos.so/2f49a117-05e7-4ae9-9e95-b9917f970adb?format=jpeg" },
      { title: "Solar Bloom", year: 2025, image: "https://cdn.cosmos.so/47caf8a0-f456-41c5-98ea-6d0476315731?format=jpeg" },
      { title: "Chromatic Loopscape", year: 2024, image: "https://cdn.cosmos.so/0f164449-f65e-4584-9d62-a9b3e1f4a90a?format=jpeg" },
      { title: "Nova Pulse", year: 2024, image: "https://cdn.cosmos.so/f733585a-081e-48e7-a30e-e636446f2168?format=jpeg" },
      { title: "Sonic Horizon", year: 2023, image: "https://cdn.cosmos.so/f99f8445-6a19-4a9a-9de3-ac382acc1a3f?format=jpeg" },
    ];

    const SOCIALS = [
      { label: "Instagram", href: "https://www.instagram.com/antnstudio/" },
      { label: "X / Twitter", href: "https://x.com/antnstudio" },
      { label: "LinkedIn", href: "https://www.linkedin.com/in/antnstudio/" },
    ];

    const settings = {
      baseWidth: 400, smallHeight: 330, largeHeight: 500, itemGap: 65,
      hoverScale: 1.05, expandedScale: 0.4, dragEase: 0.075, momentumFactor: 200,
      bufferZone: 3, zoomDuration: 0.6, overlayOpacity: 0.9, overlayEaseDuration: 0.8
    };

    /* ===== DOM ===== */
    const container = document.querySelector(".container");
    const canvas = document.getElementById("canvas");
    const overlay = document.getElementById("overlay");
    const projectTitleElement = document.querySelector(".project-title p");

    const yearsWrap   = document.getElementById("legacyYears");
    const yearsToggle = document.getElementById("legacyYearsToggle");
    const yearsClose  = document.getElementById("legacyYearsClose");
    const yearsEl     = document.getElementById("years");

    const socialsEl = document.getElementById("socials");

    /* Socials */
    SOCIALS.forEach(s => {
      const a = document.createElement("a");
      a.href = s.href; a.target = "_blank"; a.rel = "noreferrer";
      a.textContent = s.label;
      socialsEl.appendChild(a);
    });

    /* Années (menu de base) */
    const uniqueYears = Array.from(new Set(PROJECTS.map(p => p.year))).sort((a,b)=>b-a);
    const qpYear = new URLSearchParams(location.search).get("year");
    let activeYear = qpYear ? (qpYear === "all" ? "All" : String(qpYear)) : "All";

    function renderYears(){
      yearsEl.innerHTML = "";
      yearsEl.appendChild(makeYearBtn("All"));
      uniqueYears.forEach(y => yearsEl.appendChild(makeYearBtn(String(y))));
      updateYearButtons();
    }
    function makeYearBtn(label){
      const b = document.createElement("button");
      b.className = "year-btn";
      b.textContent = label;
      b.addEventListener("click", ()=>{ setActiveYear(label); closeYears(); });
      return b;
    }
    function updateYearButtons(){
      yearsEl.querySelectorAll(".year-btn").forEach(btn=>{
        btn.setAttribute("aria-pressed", String(btn.textContent === String(activeYear)));
      });
    }
    function setActiveYear(label){
      activeYear = label;
      document.documentElement.setAttribute("data-year", String(label).toLowerCase());
      resetAndRebuild();
      updateYearButtons();
    }

    function openYears(){
      yearsWrap.classList.add("open");
      yearsToggle.setAttribute("aria-expanded","true");
    }
    function closeYears(){
      yearsWrap.classList.remove("open");
      yearsToggle.setAttribute("aria-expanded","false");
    }
    yearsToggle.addEventListener("click", ()=>{
      yearsWrap.classList.toggle("open");
      yearsToggle.setAttribute("aria-expanded", yearsWrap.classList.contains("open"));
    });
    yearsClose.addEventListener("click", closeYears);

    function currentList(){
      if(activeYear==="All") return PROJECTS;
      const y = parseInt(activeYear,10);
      return PROJECTS.filter(p => p.year === y);
    }

    /* ===== Grille ===== */
    const itemSizes = [
      { width: settings.baseWidth, height: settings.smallHeight },
      { width: settings.baseWidth, height: settings.largeHeight }
    ];
    const cellWidth = settings.baseWidth + settings.itemGap;
    const cellHeight = Math.max(settings.smallHeight, settings.largeHeight) + settings.itemGap;
    let columns = 4;

    let isDragging=false,startX,startY,targetX=0,targetY=0,currentX=0,currentY=0,dragVX=0,dragVY=0,lastDrag=0;
    let mouseHasMoved=false,visibleItems=new Set(),lastUpdate=0,lastX=0,lastY=0;
    let isExpanded=false,activeItem=null,activeItemId=null,canDrag=true,overlayAnim=null,titleSplit=null;

    function setAndAnimateTitle(title){
      if(titleSplit) titleSplit.revert();
      projectTitleElement.textContent = title;
      titleSplit = new SplitType(projectTitleElement,{ types:"words" });
      gsap.set(titleSplit.words,{ y:"100%" });
    }
    function animateTitleIn(){ gsap.fromTo(titleSplit.words,{ y:"100%",opacity:0 },{ y:"0%",opacity:1,duration:1,stagger:.1,ease:"power3.out" }); }
    function animateTitleOut(){ gsap.to(titleSplit.words,{ y:"-100%",opacity:0,duration:1,stagger:.1,ease:"power3.out" }); }
    function overlayIn(){
      if(overlayAnim) overlayAnim.kill();
      overlayAnim = gsap.to(overlay,{ opacity:settings.overlayOpacity, duration:settings.overlayEaseDuration, ease:"power2.inOut", overwrite:true });
    }
    function overlayOut(){
      if(overlayAnim) overlayAnim.kill();
      overlayAnim = gsap.to(overlay,{ opacity:0, duration:settings.overlayEaseDuration, ease:"power2.inOut" });
    }

    function getItemSize(row,col){ const idx = Math.abs((row*columns+col)%itemSizes.length); return itemSizes[idx]; }
    function getItemId(col,row){ return `${col},${row}`; }
    function getItemPos(col,row){ return { x: col*cellWidth, y: row*cellHeight }; }

    function updateVisibleItems(){
      const list = currentList();
      const itemCount = list.length || 1;

      const buffer = settings.bufferZone;
      const vw = innerWidth*(1+buffer), vh = innerHeight*(1+buffer);
      const startCol = Math.floor((-currentX - vw/2)/cellWidth);
      const endCol   = Math.ceil((-currentX + vw*1.5)/cellWidth);
      const startRow = Math.floor((-currentY - vh/2)/cellHeight);
      const endRow   = Math.ceil((-currentY + vh*1.5)/cellHeight);

      const currentSet = new Set();

      for(let row=startRow; row<=endRow; row++){
        for(let col=startCol; col<=endCol; col++){
          const id = getItemId(col,row); currentSet.add(id);
          if(visibleItems.has(id)) continue;
          if(activeItemId===id && isExpanded) continue;

          const size = getItemSize(row,col);
          const pos = getItemPos(col,row);
          const idx = Math.abs((row*columns+col) % itemCount);
          const proj = list[idx];

          const item = document.createElement("div");
          item.className="item"; item.id=id;
          item.style.width = `${size.width}px`;
          item.style.height = `${size.height}px`;
          item.style.left = `${pos.x}px`;
          item.style.top  = `${pos.y}px`;
          item.dataset.width = size.width;
          item.dataset.height = size.height;
          item.dataset.year = String(proj.year);

          const imageContainer = document.createElement("div");
          imageContainer.className = "item-image-container";
          const img = document.createElement("img");
          img.src = proj.image; img.alt = proj.title;
          imageContainer.appendChild(img); item.appendChild(imageContainer);

          const caption = document.createElement("div");
          caption.className = "item-caption";
          const name = document.createElement("div"); name.className="item-name"; name.textContent = proj.title;
          const number = document.createElement("div"); number.className="item-number"; number.textContent = `#${String(idx+1).padStart(5,"0")}`;
          caption.appendChild(name); caption.appendChild(number); item.appendChild(caption);

          item.addEventListener("click", () => { if(mouseHasMoved||isDragging) return; expandItem(item, proj); });

          canvas.appendChild(item); visibleItems.add(id);
        }
      }

      // cleanup
      visibleItems.forEach((id)=>{
        if(!currentSet.has(id) || (activeItemId===id && isExpanded)){
          const el = document.getElementById(id);
          if(el && el.parentNode===canvas) canvas.removeChild(el);
          visibleItems.delete(id);
        }
      });
    }

    function expandItem(item, proj){
      isExpanded=true; activeItem=item; activeItemId=item.id; canDrag=false; container.style.cursor="auto";
      setAndAnimateTitle(proj.title);

      const rect = item.getBoundingClientRect();
      const w = parseInt(item.dataset.width,10);
      const h = parseInt(item.dataset.height,10);
      overlay.classList.add("active"); overlayIn();

      const expandedItem = document.createElement("div");
      expandedItem.className="expanded-item";
      expandedItem.style.width=`${w}px`; expandedItem.style.height=`${h}px`;
      expandedItem.style.borderRadius="var(--border-radius)";
      const img = document.createElement("img"); img.src = item.querySelector("img").src;
      expandedItem.appendChild(img);
      expandedItem.addEventListener("click", closeExpandedItem);
      document.body.appendChild(expandedItem);

      document.querySelectorAll(".item").forEach(el=>{ if(el!==activeItem) gsap.to(el,{opacity:0,duration:settings.overlayEaseDuration,ease:"power2.inOut"}); });

      const vw = innerWidth;
      const targetW = vw*settings.expandedScale;
      const aspect = h/w; const targetH = targetW*aspect;

      gsap.delayedCall(.5, animateTitleIn);
      gsap.fromTo(expandedItem,
        { width:w, height:h, x: rect.left+w/2 - innerWidth/2, y: rect.top+h/2 - innerHeight/2 },
        { width:targetW, height:targetH, x:0, y:0, duration:settings.zoomDuration, ease:"hop" }
      );

      window.__expandedItem = expandedItem;
    }

    function closeExpandedItem(){
      const expandedItem = window.__expandedItem;
      if(!expandedItem) return;
      animateTitleOut(); overlayOut();

      document.querySelectorAll(".item").forEach(el=>{ if(el.id!==activeItemId) gsap.to(el,{opacity:1,duration:settings.overlayEaseDuration,delay:.3,ease:"power2.inOut"}); });

      const rect = activeItem.getBoundingClientRect();
      const w = parseInt(activeItem.dataset.width,10);
      const h = parseInt(activeItem.dataset.height,10);

      gsap.to(expandedItem,{
        width:w, height:h,
        x: rect.left+w/2 - innerWidth/2,
        y: rect.top+h/2 - innerHeight/2,
        duration:settings.zoomDuration, ease:"hop",
        onComplete:()=>{
          expandedItem.remove();
          window.__expandedItem = null;
          isExpanded=false; activeItem=null; activeItemId=null; canDrag=true;
          container.style.cursor="grab"; overlay.classList.remove("active");
        }
      });
    }

    function animate(){
      if(canDrag){
        const e=settings.dragEase;
        currentX += (targetX-currentX)*e;
        currentY += (targetY-currentY)*e;
        canvas.style.transform = `translate(${currentX}px,${currentY}px)`;
        const now = Date.now(), dist = Math.hypot(currentX-lastX,currentY-lastY);
        if(dist>100 || now-lastUpdate>120){ updateVisibleItems(); lastX=currentX; lastY=currentY; lastUpdate=now; }
      }
      requestAnimationFrame(animate);
    }

    // drag / touch
    container.addEventListener("mousedown",(e)=>{ if(!canDrag) return; isDragging=true; mouseHasMoved=false; startX=e.clientX; startY=e.clientY; container.style.cursor="grabbing"; });
    addEventListener("mousemove",(e)=>{ if(!isDragging||!canDrag) return; const dx=e.clientX-startX, dy=e.clientY-startY; if(Math.abs(dx)>5||Math.abs(dy)>5) mouseHasMoved=true; const now=Date.now(), dt=Math.max(10, now-lastDrag); lastDrag=now; dragVX=dx/dt; dragVY=dy/dt; targetX+=dx; targetY+=dy; startX=e.clientX; startY=e.clientY; });
    addEventListener("mouseup",()=>{ if(!isDragging) return; isDragging=false; if(canDrag){ container.style.cursor="grab"; if(Math.abs(dragVX)>0.1||Math.abs(dragVY)>0.1){ targetX += dragVX*settings.momentumFactor; targetY += dragVY*settings.momentumFactor; } } });
    overlay.addEventListener("click",()=>{ if(isExpanded) closeExpandedItem(); });

    container.addEventListener("touchstart",(e)=>{ if(!canDrag) return; isDragging=true; mouseHasMoved=false; startX=e.touches[0].clientX; startY=e.touches[0].clientY; });
    addEventListener("touchmove",(e)=>{ if(!isDragging||!canDrag) return; const dx=e.touches[0].clientX-startX, dy=e.touches[0].clientY-startY; if(Math.abs(dx)>5||Math.abs(dy)>5) mouseHasMoved=true; targetX+=dx; targetY+=dy; startX=e.touches[0].clientX; startY=e.touches[0].clientY; });
    addEventListener("touchend",()=>{ isDragging=false; });

    addEventListener("resize",()=>{ if(isExpanded&&window.__expandedItem&&activeItem){ const w=parseInt(activeItem.dataset.width,10), h=parseInt(activeItem.dataset.height,10); const targetW=innerWidth*settings.expandedScale, targetH=targetW*(h/w); gsap.to(window.__expandedItem,{width:targetW,height:targetH,duration:.3,ease:"power2.out"}); } else { updateVisibleItems(); } });

    function resetAndRebuild(){
      const ids=[...visibleItems]; ids.forEach(id=>{ const el=document.getElementById(id); if(el&&el.parentNode===canvas) canvas.removeChild(el); });
      visibleItems.clear();
      currentX=currentY=targetX=targetY=lastX=lastY=0; canvas.style.transform="translate(0,0)";
      updateVisibleItems();
    }

    /* Pilotage parent éventuel */
    window.addEventListener("message", (evt) => {
      const data = evt && evt.data;
      if (!data || data.type !== "SET_YEAR") return;
      const value = data.value;
      document.documentElement.setAttribute("data-year-controlled", "true");
      setActiveYear(value === "all" ? "All" : String(value));
      openYears();
    });

    /* Init (menu fermé par défaut) */
    renderYears();
    closeYears();
    setActiveYear(activeYear);
    updateVisibleItems();
    animate();
  })();
  </script>
</body>
</html>
